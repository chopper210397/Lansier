---
title: "Reporte Comercial"
output:
  html_document:
    toc: yes
    toc_float: yes
    collapsed: no
    number_sections: no
    toc_depth: 1

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(message=FALSE,warning=FALSE, cache=TRUE)
library(lubridate)
setwd("C:/Users/LBarrios/Desktop/testgithub/Lansier")
```
Informes generados por el área de análisis comercial.

# Performance por categorización 


```{r FIG1 setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(kableExtra)
library(tidyverse)
library(tinytex)
library(knitr)
library(readxl)
library(ggplot2)
library(lubridate)
library(colorspace)
library(RODBC)
sqlcomercial<-odbcConnect("SQLuis",uid = "sa",pwd = "Comercial.2020")
fecharcarga<-sqlQuery(sqlcomercial,"select * from Fechas_Carga")
data<-read_xlsx("datapresentacion.xlsx") #borre todo el path que decia C/USERS,etc y lo deje solo en el nombre de el archivo, asi ya no importa donde lo corra siempre y cuando este en el wd
#con los siguientes comandos se le da cierto formato a la tabla para que sea mas facil de presentar la data en una tabla
# AL PARECER PARA QUE ACTUALICE LA DATA TENGO QUE CAMBIAR ALGO DEL CODIGO SINO NO CORRE
tabla<-data %>% select(-3) %>% select(-1)
for (i in 3:8) {
  tabla[,i]<-tabla[,i]
  
}
for (i in 1:5) {
  tabla[i,1]<-substr(tabla[i,1],5,nchar(tabla[i,1])-4)
}

for (i in 6:10) {
  tabla[i,1]<-substr(tabla[i,1],5,nchar(tabla[i,1])-4)
}
for (i in 16:19) {
  tabla[i,1]<-substr(tabla[i,1],5,nchar(tabla[i,1]))
}

# He borrado los *100(multiplicado por 100) en la linea 28 y linea 75 porque ahora mis valores no estan en decimales sino enteros, revisar eso
```

```{r , echo=FALSE, fig.pos="H"}

tabla %>%
  kbl(booktabs = TRUE, caption = paste0("Actualizado al ",today())) %>%
  kable_styling(bootstrap_options = c("striped","bordered","hover","condensed","responsive")) %>% 
  pack_rows("RR MM Lima Azul", 1, 5,color = "blue") %>%
  pack_rows("RR MM Lima Rojo", 6, 10,color = "red") %>%
  pack_rows("RR MM Provincias", 11, 15,color = "green") %>%
  pack_rows("VENDEDORES Lima", 16, 19) %>%
  row_spec(0,bold=T) %>% 
  footnote(number=c("Fecha de actualización fuentes:",
                    paste0("LANSIER: ",fecharcarga[1,2]),
                    paste("METRONIC: ",fecharcarga[2,2]) ,
                    paste0("DIFARLIB: ",fecharcarga[3,2]),
                    paste0("CASTILLO: ",fecharcarga[4,2]),
                    paste0("M&M: ",fecharcarga[5,2]),
                    paste0("DIMEXA: ",fecharcarga[6,2]),
                      "Los valores estan en porcentajes")) %>% 
 column_spec(3, color = "black",bold=T, background = ifelse(tabla$Total > 100, "green", ifelse(tabla$Total<80,"red","yellow")))
   
        
 

```

# Cumplimiento por zona
```{r echo=FALSE,fig.pos="H"}
data %>%
  mutate(Total=Total) %>% 
  ggplot(aes(x=reorder(Nombre,Total),y=Total))+
  geom_bar(stat = "identity",color="black",fill="steelblue")+
  coord_flip()+labs(x="",y="%")+
          theme_minimal()+
  geom_text(aes(label=Total), hjust=-0.15, size=2.6)+
  geom_hline(yintercept = 40,linetype="dotted",color="black")+
  geom_text(aes(0,40,label = 40, vjust = 0),
            size=3,
            colour="black"
            )
```

# Analisis competentencia
Y asi se pueden ir agregando mas tablas graficos y conclusiones que se generan automatico y se cargan a esta web creada para Lansier, a la izquierda irian apareciendo los nuevos titulos que se asignen conforme se vayan creando, asi podrian hallar mas rapidamente lo que estan buscando, esto podria ser un reemplazo del pdf, me comentó que podia ser una opción para que los jefes no tengan que estar abriendo pdfs cada que les envio, asi que ahi esta la idea y tal vez se puede modificar algo o volver al pdf, lo bueno de esta web es que siempre esta online, solo se necesita el link, es similar a como funciona un dashboard de power bi, el unico esfuerzo es ejecutra el programa para que actualice la data jalando del sql y cree el reporte con todo actualizado al igual que hacemos en el power bi. 